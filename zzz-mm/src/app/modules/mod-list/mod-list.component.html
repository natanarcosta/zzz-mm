<main id="mod-list" [ngClass]="{ 'min-h': !selectedAgent() }">
  <section class="header">
    @if (enableShuffleMod()) {
      <i
        class="fa-solid fa-shuffle"
        (click)="pickRandomMod()"
        matTooltip="Enable Random Mod"
      ></i>
    }

    <i
      class="fa-solid fa-rotate-right"
      (click)="handleRefreshMods()"
      matTooltip="Refresh Mods"
    ></i>
    <i
      class="fa-solid fa-circle-plus"
      (click)="handleAddNewMod()"
      matTooltip="Add New Mod"
    ></i>

    @if (blur()) {
      <i
        class="fa-solid fa-eye-low-vision"
        (click)="toggleBlur()"
        matTooltip="Disable Blur "
      ></i>
    } @else {
      <i
        class="fa-solid fa-eye"
        (click)="toggleBlur()"
        matTooltip="Enable Blur"
      ></i>
    }
    <i
      class="fa-solid fa-gear"
      (click)="openConfigDialog()"
      matTooltip="Mod Manager Config"
    ></i>
  </section>
  @if (selectedAgent() || showAllActiveWhenEmpty()) {
    <h1>
      {{
        selectedAgent()
          ? (selectedAgent()!.name | agentName) + ' mods'
          : 'Active mods'
      }}
      <span class="count">{{ displayedMods()?.length || 0 }}</span>
    </h1>
    <section class="list-wrapper">
      @for (mod of displayedMods(); track mod.folderName) {
        <div
          class="mod-card"
          [ngClass]="{ active: mod.json?.active, broken: mod.json?.broken }"
        >
          <div class="image">
            <img
              [ngClass]="{ censor: blur(), grayscale: mod.json?.broken }"
              [src]="mod.previewPath || (selectedAgent() ? 'assets/char-portraits/' + selectedAgent()!.id + '.png' : getPortraitForMod(mod))"
            />

            <!-- OVERLAY -->
            <div class="overlay">
              <button
                class="action primary"
                [ngClass]="{ danger: mod.json?.active }"
                (click)="toggleMod(mod); $event.stopPropagation()"
                [disabled]="mod.json?.broken"
              >
                {{
                  mod.json?.broken
                    ? "Broken"
                    : mod.json?.active
                    ? "Disable"
                    : "Activate"
                }}
              </button>

              <button
                class="action secondary"
                (click)="openDetailsDialog(mod); $event.stopPropagation()"
              >
                Details
              </button>
            </div>
          </div>

          <div class="content">
            <span class="truncate">{{ mod.json?.modName || mod.folderName }}</span>
            @if (mod.json?.broken) {
              <span class="badge broken">Broken</span>
            }
          </div>
        </div>
      } @empty {
        No active mods.
      }
    </section>
  } @else {
    <div class="empty-wrapper">
      <div class="empty-agent-state">
        <div class="icon">
          <i class="fa-solid fa-user-ninja"></i>
        </div>

        <h2>Choose an agent</h2>
        <p>Select an agent on the left to manage its mods.</p>

        <div class="hint">
          <i class="fa-solid fa-arrow-left"></i>
          <span>Select one from the sidebar</span>
        </div>
      </div>
    </div>
  }
</main>
