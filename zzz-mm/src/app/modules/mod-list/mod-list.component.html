<main id="mod-list" [ngClass]="{ 'min-h': !selectedAgent() }">
  <section class="header">
    @if (enableShuffleMod()) {
      <i
        class="fa-solid fa-shuffle"
        (click)="pickRandomMod()"
        matTooltip="Enable Random Mod"
      ></i>
    }

    <i
      class="fa-solid fa-rotate-right"
      (click)="handleRefreshMods()"
      matTooltip="Refresh Mods"
    ></i>
    <i
      class="fa-solid fa-circle-plus"
      (click)="handleAddNewMod()"
      matTooltip="Add New Mod"
    ></i>

    @if (blur()) {
      <i
        class="fa-solid fa-eye-low-vision"
        (click)="toggleBlur()"
        matTooltip="Disable Blur "
      ></i>
    } @else {
      <i
        class="fa-solid fa-eye"
        (click)="toggleBlur()"
        matTooltip="Enable Blur"
      ></i>
    }
    <i
      class="fa-solid fa-gear"
      (click)="openConfigDialog()"
      matTooltip="Mod Manager Config"
    ></i>

    <!-- Preset Controls -->
    <div class="preset-controls">
      <label>Preset:</label>
      <mat-select
        (valueChange)="onPresetChange($event)"
        [value]="presetService.activePresetId()"
        panelClass="preset-selector"
      >
        @for (p of presetService.presets(); track p.id) {
          <mat-option [value]="p.id">
            <span class="preset-option">
              {{ p.name }}
              <i
                class="fa-solid fa-trash"
                *ngIf="
                  p.id !== presetService.activePresetId() && p.id !== 'default'
                "
                (click)="
                  $event.preventDefault();
                  $event.stopPropagation();
                  onDeletePreset(p.id)
                "
              ></i>
            </span>
          </mat-option>
        }
      </mat-select>
      <button
        mat-raised-button
        color="primary"
        (click)="createPreset()"
        matTooltip="Create new preset"
      >
        Create
      </button>
    </div>
  </section>
  @if (selectedAgent()) {
    <h1>
      {{ selectedAgent()!.name | agentName }} mods
      <span class="count">{{ selectedAgentMods()?.length }}</span>
    </h1>
    <section class="list-wrapper">
      @for (mod of selectedAgentMods(); track mod.folderName) {
        <div class="mod-card" [ngClass]="{ active: mod.json?.active }">
          <div class="image">
            <img
              [ngClass]="{ censor: blur() }"
              [src]="
                mod.previewPath ||
                'assets/char-portraits/' + selectedAgent()!.id + '.png'
              "
            />

            <!-- OVERLAY -->
            <div class="overlay">
              <button
                class="action primary"
                [ngClass]="{ danger: mod.json?.active }"
                (click)="toggleMod(mod); $event.stopPropagation()"
              >
                {{ mod.json?.active ? "Disable" : "Activate" }}
              </button>

              <button
                class="action secondary"
                (click)="openDetailsDialog(mod); $event.stopPropagation()"
              >
                Details
              </button>
            </div>
          </div>

          <div class="content">
            {{ mod.json?.modName || mod.folderName }}
          </div>
        </div>
      } @empty {
        Agente n√£o possue mods.
      }
    </section>
  } @else {
    <div class="empty-wrapper">
      <div class="empty-agent-state">
        <div class="icon">
          <i class="fa-solid fa-user-ninja"></i>
        </div>

        <h2>Choose an agent</h2>
        <p>Select an agent on the left to manage its mods.</p>

        <div class="hint">
          <i class="fa-solid fa-arrow-left"></i>
          <span>Select one from the sidebar</span>
        </div>
      </div>
    </div>
  }
</main>
